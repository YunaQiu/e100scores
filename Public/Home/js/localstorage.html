<script>
//坑爹Thinkphp！为什么不给我解析public里面的文件啊啊啊，人家要用:U函数啊喂~
var LocalStorage = (function(){
	localStorage = window.localStorage;

	function isExist(name){
		var userData = localStorage.getItem(name);
		if (userData){
			return true;
		}else{
			return false;
		}
	}
	function getStorage(name){
		var userData = localStorage.getItem(name);
		if (userData){
			return $.parseJSON(userData);	
		}else{
			return false;
		}
	}
	function setStorage(name, obj){
		var data = JSON.stringify(obj);
		localStorage.setItem(name, data);
	}

	return {
		isExist: isExist,
		get: getStorage,
		set: setStorage
	};
})();

function UserStorage(alias){
	var storage = window.localStorage;
	var name = alias + '-user';
	function isExist(){
		var userData = LocalStorage.isExist(name);
		return userData;
	}
	function getStorage(){
		var userData = LocalStorage.get(name);
		return userData;
	}
	function setStorage(obj){
		LocalStorage.set(name, obj);
	}
	function getSingleRecord(number){
		var userData = getStorage();
		if (!userData){
			return false;
		}
		if (userData.length >= number){
			return userData[number-1];
		}else{
			return false;
		}
	}
	function setSingleRecord(number, obj){
		var userData = getStorage();
		if (!userData){
			userData = new Array();
		}
		if (userData.length >= number - 1){
			userData[number-1] = obj;
			setStorage(userData);
			return true;
		}else{
			return false;
		}
	}
	function uploadCloud(){
		var data = storage.getItem(name);		//因为不需要将字符串数据转对象，所以使用原有的localstorage方法
		$.post('{:U("Practice/updateUserData")}', 
			{
				bank: alias,
				data: data
			});
	}
	function downloadData(){
		$.post('{:U("Practice/loadUserData")}', {bank: name}, function(result){
			if (result.status == 0){
				LocalStorage.set(name, result.data);
			}
		}, 'json');
	}

	this.isExist = isExist;
	this.getAll = getStorage;
	this.setAll = setStorage;
	this.get = getSingleRecord;
	this.set = setSingleRecord;
	this.upload = uploadCloud;
	this.download = downloadData;
}

function BankStorage(name){
	this.name = name;
	function download(){
		$.post('{:U("Practice/loadBank")}', {bank: this.name}, function(result){
			if (result.status == 0){
				LocalStorage.set(name, result.data);
			}
		}, 'json');
	}
	function getSingleRecord(number){
		var userData = LocalStorage.get(this.name);
		if (userData.length >= number){
			return userData[number-1];
		}else{
			return false;
		}
	}

	this.isExist = LocalStorage.isExist;
	this.load = download;
	this.getAll = LocalStorage.get;
	this.get = getSingleRecord;
};
</script>